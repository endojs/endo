// Not guaranteed to sort all array elements and weird keys properly, but definitely good enough for the usecase
module.exports = function stableOrderJson(obj) {
  return JSON.stringify(obj, (_, v) => {
    if (v && v.constructor === Object) {
      return Object.fromEntries(
        Object.keys(v)
          .sort()
          .map(k => [k, v[k]]),
      );
    }
    if (v && v.constructor === Array) {
      return v.sort();
    }
    return v;
  });
};
