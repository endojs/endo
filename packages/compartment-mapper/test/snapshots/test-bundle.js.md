# Snapshot report for `test/test-bundle.js`

The actual snapshot is saved in `test-bundle.js.snap`.

Generated by [AVA](https://avajs.dev).

## bundles work

> Snapshot 1

    `'use strict';␊
    (() => {␊
      const functors = [␊
    // === functors[0] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   let cycle1;$h‍_imports([["./cycle1.js", [["cycle1", [$h‍_a => (cycle1 = $h‍_a)]]]]]);   ␊
    ␊
    let cycle2=  'cycle-mjs-22';$h‍_once.cycle2(cycle2);␊
    })␊
    ,␊
    // === functors[1] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   let cycle2;$h‍_imports([["./cycle2.js", [["cycle2", [$h‍_a => (cycle2 = $h‍_a)]]]]]);   ␊
    ␊
    let cycle1=  'cycle-mjs-11';$h‍_once.cycle1(cycle1);␊
    })␊
    ,␊
    // === functors[2] ===␊
    (function (require, exports, module, __filename, __dirname) { const cycle3 = require('./cycle3.cjs');␊
    ␊
    const cycle4 = 'cycle-cjs-44'␊
    module.exports = { cycle4 }; //*/␊
    })␊
    ␊
    ,␊
    // === functors[3] ===␊
    (function (require, exports, module, __filename, __dirname) { const cycle4 = require('./cycle4.cjs');␊
    ␊
    const cycle3 = 'cycle-cjs-33'␊
    module.exports = { cycle3 }; //*/␊
    })␊
    ␊
    ,␊
    // === functors[4] ===␊
    (function (require, exports, module, __filename, __dirname) { const hello = 1;␊
    module.exports = { hello } //*/␊
    })␊
    ␊
    ,␊
    // === functors[5] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const{default:$c‍_default}={default:'foo'};$h‍_once.default($c‍_default);␊
    })␊
    ,␊
    // === functors[6] ===␊
    (function (require, exports, module, __filename, __dirname) { module.exports = 123; //*/␊
    })␊
    ␊
    ,␊
    // === functors[7] ===␊
    (function (require, exports, module, __filename, __dirname) { // this is for testing commonjs import with a specifier lacking a suffix␊
    require('./util')␊
    ␊
    require('bundle/icando.cjs')␊
    ␊
    print('dependency');␊
     //*/␊
    })␊
    ␊
    ,␊
    // === functors[8] ===␊
    (function (require, exports, module, __filename, __dirname) { const zzz = require('./requireme.cjs').hello || 404;␊
    const fromMjs = require('./import-default-export-from-me');␊
    const dependency = require('bundle-dep-cjs');␊
    module.exports = { zzz, fromMjs }; //*/␊
    })␊
    ␊
    ,␊
    // === functors[9] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        c=  'sea';$h‍_once.c(c);␊
    const        i=  'eye';$h‍_once.i(i);␊
    const        k=  'que';$h‍_once.k(k);␊
    const        q=  'cue';$h‍_once.q(q);␊
    const        u=  'you';$h‍_once.u(u);␊
    const        y=  'why';$h‍_once.y(y);␊
    })␊
    ,␊
    // === functors[10] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        color=  'blue';$h‍_once.color(color);␊
    })␊
    ,␊
    // === functors[11] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const fizz=  'fizz';$h‍_once.fizz(fizz);␊
    const bizz=  'bizz';$h‍_once.bizz(bizz);␊
    const buzz=  'buzz';$h‍_once.buzz(buzz);␊
    })␊
    ,␊
    // === functors[12] ===␊
    {␊
      "name": "bundle",␊
      "parsers": {␊
        "js": "mjs"␊
      },␊
      "main": "./main.js",␊
      "dependencies": {␊
        "bundle-dep": "*",␊
        "bundle-dep-cjs": "*"␊
      },␊
      "exports": {␊
        ".":"./main.js",␊
        "./icando.cjs":"./icando.cjs"␊
      },␊
      "scripts": {␊
        "preinstall": "echo DO NOT INSTALL TEST FIXTURES; exit -1"␊
      }␊
    }␊
    ,␊
    // === functors[13] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        red=  '#f00';$h‍_once.red(red);␊
    const        green=  '#0f0';$h‍_once.green(green);␊
    const        blue=  '#00f';$h‍_once.blue(blue);␊
    })␊
    ,␊
    // === functors[14] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([["./import-and-export-all.js", []]]);   ␊
    })␊
    ,␊
    // === functors[15] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        gray=  '#777';$h‍_once.gray(gray);␊
    })␊
    ,␊
    // === functors[16] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        qux=  'qux';$h‍_once.qux(qux);␊
    })␊
    ,␊
    // === functors[17] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([["./import-and-reexport-name-from-me.js", []],["./import-and-reexport-name-as-from-me.js", []]]);   ␊
    })␊
    ,␊
    // === functors[18] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([["bundle", []]]);   ␊
    ␊
    print('dependency');␊
    })␊
    ,␊
    // === functors[19] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   let foo,bar,baz,fizz,buzz,colour,qux,grey,colors,cjsstuff,pkg,cycle1,cycle3;$h‍_imports([["./import-default-export-from-me.js", [["default", [$h‍_a => (foo = $h‍_a)]]]],["./import-all-from-me.js", [["*", [$h‍_a => (bar = $h‍_a),$h‍_a => (baz = $h‍_a)]]]],["./import-named-exports-from-me.js", [["fizz", [$h‍_a => (fizz = $h‍_a)]],["buzz", [$h‍_a => (buzz = $h‍_a)]]]],["./import-named-export-and-rename.js", [["color", [$h‍_a => (colour = $h‍_a)]]]],["./reexport-name.js", [["qux", [$h‍_a => (qux = $h‍_a)]],["grey", [$h‍_a => (grey = $h‍_a)]]]],["./reexport-all.js", [["*", [$h‍_a => (colors = $h‍_a)]]]],["bundle-dep", []],["./icando.cjs", [["*", [$h‍_a => (cjsstuff = $h‍_a)]]]],["./package.json", [["default", [$h‍_a => (pkg = $h‍_a)]]]],["./cycle1.js", [["cycle1", [$h‍_a => (cycle1 = $h‍_a)]]]],["./cycle3.cjs", [["cycle3", [$h‍_a => (cycle3 = $h‍_a)]]]]]);   ␊
    ␊
    ␊
    print(foo);␊
    ␊
    ␊
    print(bar);␊
    // Once more with feeling.␊
    ␊
    print(baz);␊
    ␊
    ␊
    print(fizz);␊
    print(buzz);␊
    ␊
    ␊
    print(colour);␊
    ␊
    ␊
    print(qux);␊
    print(grey);␊
    ␊
    ␊
    print(colors);␊
    ␊
    ␊
    ␊
    ␊
    print(cjsstuff);␊
    ␊
    ␊
    print(pkg.name);␊
    ␊
    ␊
    print(cycle1);␊
    ␊
    print(cycle3);␊
    })␊
    ,␊
    ]; // functors end␊
    ␊
    //runtime␊
      function cell(name, value = undefined) {␊
      const observers = [];␊
      return Object.freeze({␊
        get: Object.freeze(() => {␊
          return value;␊
        }),␊
        set: Object.freeze(newValue => {␊
          value = newValue;␊
          for (const observe of observers) {␊
            observe(value);␊
          }␊
        }),␊
        observe: Object.freeze(observe => {␊
          observers.push(observe);␊
          observe(value);␊
        }),␊
        enumerable: true,␊
      });␊
    }␊
    function makeCells(orderedCells, reexports) {␊
      const cells = orderedCells.map(cs =>␊
        cs.reduce((kv, c) => {␊
          kv[c] = cell(c);␊
          return kv;␊
        }, {}),␊
      );␊
      for (const [to, from] of reexports) {␊
        Object.defineProperties(␊
          cells[to],␊
          Object.getOwnPropertyDescriptors(cells[from]),␊
        );␊
      }␊
      return cells;␊
    }function observeImports(map, pairs) {␊
      for (const [importName, importIndex] of pairs) {␊
        for (const [name, observers] of map.get(importName)) {␊
          const cell = cells[importIndex][name];␊
          if (cell === undefined) {␊
            throw new ReferenceError(\`Cannot import name ${name}\`);␊
          }␊
          for (const observer of observers) {␊
            cell.observe(observer);␊
          }␊
        }␊
      }␊
    }function wrapCjsFunctor(num) {␊
      return ({ imports = {} }) => {␊
        const cModule = Object.freeze(␊
          Object.defineProperty({}, 'exports', cells[num].default),␊
        );␊
        // TODO: specifier not found handling␊
        const requireImpl = specifier => cells[imports[specifier]].default.get();␊
        functors[num](Object.freeze(requireImpl), cModule.exports, cModule);␊
        Object.keys(cells[num])␊
          .filter(k => k !== 'default' && k !== '*')␊
          .map(k => cells[num][k].set(cModule.exports[k]));␊
      };␊
    }␊
    // runtime end␊
      const cells = makeCells(␊
    [␊
      [␊
        "cycle2"␊
      ],␊
      [␊
        "cycle1"␊
      ],␊
      [␊
        "cycle4",␊
        "default"␊
      ],␊
      [␊
        "cycle3",␊
        "default"␊
      ],␊
      [␊
        "hello",␊
        "default"␊
      ],␊
      [␊
        "default"␊
      ],␊
      [␊
        "default"␊
      ],␊
      [␊
        "default"␊
      ],␊
      [␊
        "zzz",␊
        "fromMjs",␊
        "default"␊
      ],␊
      [␊
        "c",␊
        "i",␊
        "k",␊
        "q",␊
        "u",␊
        "y"␊
      ],␊
      [␊
        "color"␊
      ],␊
      [␊
        "fizz",␊
        "bizz",␊
        "buzz"␊
      ],␊
      [␊
        "default"␊
      ],␊
      [␊
        "red",␊
        "green",␊
        "blue"␊
      ],␊
      [],␊
      [␊
        "gray"␊
      ],␊
      [␊
        "qux"␊
      ],␊
      [␊
        "qux",␊
        "gray"␊
      ],␊
      [],␊
      []␊
    ],␊
    /* export * from */␊
    [[14,13]]␊
    );␊
    ␊
    ␊
      Object.defineProperties(cells[17], {"qux": { value: cells[16]["qux"] },"grey": { value: cells[15]["gray"] } });␊
    ␊
      const namespaces = cells.map(cells => Object.freeze(Object.create(null, cells)));␊
    ␊
      for (let index = 0; index < namespaces.length; index += 1) {␊
        cells[index]['*'] = cell('*', namespaces[index]);␊
      }␊
    ␊
      functors[0]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, [␊
          ["./cycle1.js", 1],␊
          ]);},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          cycle2: cells[0].cycle2.set,␊
        },␊
      });␊
      functors[1]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, [␊
          ["./cycle2.js", 0],␊
          ]);},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          cycle1: cells[1].cycle1.set,␊
        },␊
      });␊
      wrapCjsFunctor(2)({imports: {"./cycle3.cjs":3}});␊
      wrapCjsFunctor(3)({imports: {"./cycle4.cjs":2}});␊
      wrapCjsFunctor(4)({imports: {}});␊
      functors[5]({␊
        imports() {},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          default: cells[5].default.set,␊
        },␊
      });␊
      wrapCjsFunctor(6)({imports: {}});␊
      wrapCjsFunctor(7)({imports: {"./util":6,"bundle/icando.cjs":8}});␊
      wrapCjsFunctor(8)({imports: {"./requireme.cjs":4,"./import-default-export-from-me":5,"bundle-dep-cjs":7}});␊
      functors[9]({␊
        imports() {},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          c: cells[9].c.set,␊
          i: cells[9].i.set,␊
          k: cells[9].k.set,␊
          q: cells[9].q.set,␊
          u: cells[9].u.set,␊
          y: cells[9].y.set,␊
        },␊
      });␊
      functors[10]({␊
        imports() {},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          color: cells[10].color.set,␊
        },␊
      });␊
      functors[11]({␊
        imports() {},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          fizz: cells[11].fizz.set,␊
          bizz: cells[11].bizz.set,␊
          buzz: cells[11].buzz.set,␊
        },␊
      });␊
      cells[12].default.set(functors[12]);␊
      functors[13]({␊
        imports() {},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          red: cells[13].red.set,␊
          green: cells[13].green.set,␊
          blue: cells[13].blue.set,␊
        },␊
      });␊
      functors[14]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, [␊
          ["./import-and-export-all.js", 13],␊
          ]);},␊
        liveVar: {␊
        },␊
        onceVar: {␊
        },␊
      });␊
      functors[15]({␊
        imports() {},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          gray: cells[15].gray.set,␊
        },␊
      });␊
      functors[16]({␊
        imports() {},␊
        liveVar: {␊
        },␊
        onceVar: {␊
          qux: cells[16].qux.set,␊
        },␊
      });␊
      functors[17]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, [␊
          ["./import-and-reexport-name-as-from-me.js", 15],␊
          ["./import-and-reexport-name-from-me.js", 16],␊
          ]);},␊
        liveVar: {␊
        },␊
        onceVar: {␊
        },␊
      });␊
      functors[18]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, [␊
          ["bundle", 19],␊
          ]);},␊
        liveVar: {␊
        },␊
        onceVar: {␊
        },␊
      });␊
      functors[19]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, [␊
          ["./cycle1.js", 1],␊
          ["./cycle3.cjs", 3],␊
          ["./icando.cjs", 8],␊
          ["./import-all-from-me.js", 9],␊
          ["./import-default-export-from-me.js", 5],␊
          ["./import-named-export-and-rename.js", 10],␊
          ["./import-named-exports-from-me.js", 11],␊
          ["./package.json", 12],␊
          ["./reexport-all.js", 14],␊
          ["./reexport-name.js", 17],␊
          ["bundle-dep", 18],␊
          ]);},␊
        liveVar: {␊
        },␊
        onceVar: {␊
        },␊
      });␊
    ␊
      return cells[cells.length - 1]['*'].get();␊
    })();␊
    `

> Snapshot 2

    {
      bundleSize: 11625,
    }
