# Snapshot report for `test/compartment-map-transforms.test.js`

The actual snapshot is saved in `compartment-map-transforms.test.js.snap`.

Generated by [AVA](https://avajs.dev).

## Compartment Map Transforms - integration with mapNodeModules()

> Snapshot 1

    {
      compartments: {
        '<ATTENUATORS>': {
          label: '<ATTENUATORS>',
          location: '<ATTENUATORS>',
          modules: {},
          name: '<ATTENUATORS>',
          packageDescriptor: {
            name: '<ATTENUATORS>',
          },
          parsers: {
            bytes: 'bytes',
            cjs: 'cjs',
            js: 'cjs',
            json: 'json',
            mjs: 'mjs',
            text: 'text',
          },
          policy: {
            defaultAttenuator: undefined,
            packages: 'any',
          },
          scopes: {},
          sourceDirname: 'webpackish-app',
          types: {},
        },
        'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/': {
          label: '$root$',
          location: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/',
          modules: {
            '.': {
              compartment: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/',
              createdBy: 'node-modules',
              module: './index.js',
            },
            'webpackish-app': {
              compartment: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/',
              createdBy: 'node-modules',
              module: './index.js',
            },
          },
          name: 'webpackish-app',
          packageDescriptor: {
            devDependencies: {
              'jorts-folder': '^1.0.0',
              pantspack: '^1.0.0',
            },
            name: 'webpackish-app',
            scripts: {
              build: 'node ../pantspack/pantspack.js --config pantspack.config.js',
              preinstall: 'echo DO NOT INSTALL TEST FIXTURES; exit -1',
            },
            version: '1.2.3',
          },
          parsers: {
            bytes: 'bytes',
            cjs: 'cjs',
            js: 'cjs',
            json: 'json',
            mjs: 'mjs',
            text: 'text',
          },
          policy: {
            builtins: 'any',
            globals: 'any',
            packages: 'any',
          },
          scopes: {
            'webpackish-app': {
              compartment: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/',
            },
          },
          sourceDirname: 'webpackish-app',
          types: {},
        },
      },
      entry: {
        compartment: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/',
        module: './build.js',
      },
      tags: [],
    }

## Compartment Map Transforms - integration with captureFromMap()

> Snapshot 1

    {
      captureCompartmentMap: {
        compartments: {
          $root$: {
            label: '$root$',
            location: '$root$',
            modules: {
              './build.js': {
                createdBy: 'digest',
                location: 'build.js',
                parser: 'pre-cjs-json',
                sha512: undefined,
              },
              pantspack: {
                compartment: 'pantspack',
                createdBy: 'node-modules',
                module: './pantspack.js',
              },
            },
            name: 'webpackish-app',
            policy: {
              builtins: 'any',
              globals: 'any',
              packages: 'any',
            },
          },
          pantspack: {
            label: 'pantspack',
            location: 'pantspack',
            modules: {
              './pantspack.js': {
                createdBy: 'digest',
                location: 'pantspack.js',
                parser: 'pre-cjs-json',
                sha512: undefined,
              },
              'pantspack-folder-runner': {
                compartment: 'pantspack>pantspack-folder-runner',
                createdBy: 'node-modules',
                module: './index.js',
              },
            },
            name: 'pantspack',
            policy: {
              builtins: {
                'node:console': true,
                'node:path': true,
                'node:util': true,
              },
              packages: {
                $root$: true,
                'pantspack>pantspack-folder-runner': true,
              },
            },
          },
          'pantspack>pantspack-folder-runner': {
            label: 'pantspack>pantspack-folder-runner',
            location: 'pantspack>pantspack-folder-runner',
            modules: {
              './index.js': {
                createdBy: 'digest',
                location: 'index.js',
                parser: 'pre-cjs-json',
                sha512: undefined,
              },
            },
            name: 'pantspack-folder-runner',
            policy: {
              packages: {
                'jorts-folder': true,
              },
            },
          },
        },
        entry: {
          compartment: '$root$',
          module: './build.js',
        },
        tags: [],
      },
      captureSources: {
        $root$: {
          './build.js': {
            bytes: Uint8Array [
              7b22696d 706f7274 73223a5b 2270616e 74737061 636b225d 2c226578 706f7274
              73223a5b 22646566 61756c74 225d2c22 72656578 706f7274 73223a5b 2270616e
              74737061 636b225d 2c22736f 75726365 223a2228 66756e63 74696f6e 20287265
              71756972 652c2065 78706f72 74732c20 6d6f6475 6c652c20 5f5f6669 6c656e61
              6d652c20 5f5f6469 726e616d 6529207b 20277573 65207374 72696374 273b206d
              6f64756c 652e6578 706f7274 73203d20 72657175 69726528 2770616e 74737061
              636b2729 5c6e202f 2f2a2f5c 6e7d295c 6e227d
            ],
            location: 'build.js',
            parser: 'pre-cjs-json',
            record: {
              cjsFunctor: `(function (require, exports, module, __filename, __dirname) { 'use strict'; module.exports = require('pantspack')␊
               //*/␊
              })␊
              `,
              execute: Function noopExecute {},
              exports: [
                'default',
              ],
              imports: [
                'pantspack',
              ],
              reexports: [
                'pantspack',
              ],
            },
            sha512: undefined,
            sourceDirname: 'webpackish-app',
            sourceLocation: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/build.js',
          },
        },
        'jorts-folder': {},
        pantspack: {
          './pantspack.js': {
            bytes: Uint8Array [
              7b22696d 706f7274 73223a5b 2270616e 74737061 636b2d66 6f6c6465 722d7275
              6e6e6572 222c226e 6f64653a 636f6e73 6f6c6522 2c226e6f 64653a70 61746822
              2c226e6f 64653a75 74696c22 5d2c2265 78706f72 7473223a 5b226465 6661756c
              74225d2c 22726565 78706f72 7473223a 5b5d2c22 736f7572 6365223a 22286675
              6e637469 6f6e2028 72657175 6972652c 20657870 6f727473 2c206d6f 64756c65
              2c205f5f 66696c65 6e616d65 2c205f5f 6469726e 616d6529 207b2027 75736520
              73747269 6374273b 20277573 65207374 72696374 273b5c6e 5c6e636f 6e737420
              7b20666f 6c645061 6e747346 6f6c6465 7273207d 203d2072 65717569 72652827
              70616e74 73706163 6b2d666f 6c646572 2d72756e 6e657227 293b5c6e 636f6e73
              7420636f 6e736f6c 65203d20 72657175 69726528 276e6f64 653a636f 6e736f6c
              6527293b 5c6e636f 6e737420 70617468 203d2072 65717569 72652827 6e6f6465
              3a706174 6827293b 5c6e636f 6e737420 7574696c 203d2072 65717569 72652827
              6e6f6465 3a757469 6c27293b 5c6e5c6e 2f2a2a5c 6e202a20 40696d70 6f727420
              7b506163 6b616765 44657363 72697074 6f727d20 66726f6d 20272e2e 2f2e2e2f
              2e2e2f2e 2e2f7372 632f7479 7065732e 6a73275c 6e202a2f 5c6e5c6e 2f2a2a5c
              6e202a5c 6e202a20 40706172 616d207b 73747269 6e677d20 66726f6d 5c6e202a
              20407265 7475726e 73207b7b 7061636b 61676544 65736372 6970746f 723a2050
              61636b61 67654465 73637269 70746f72 2c207061 636b6167 654c6f63 6174696f
              6e3a2073 7472696e 677d7d5c 6e202a2f 5c6e636f 6e737420 66696e64 5061636b
              61676544 65736372 6970746f 72203d20 66726f6d 203d3e20 7b5c6e20 20636f6e
              73742063 75727265 6e74203d 2066726f 6d3b5c6e 2020666f 7220283b 3b29207b
              5c6e2020 2020636f 6e737420 7061636b 6167654a 736f6e50 61746820 3d207061
              74682e6a 6f696e28 63757272 656e742c 20277061 636b6167 652e6a73 6f6e2729
              3b5c6e20 20202074 7279207b 5c6e2020 20202020 636f6e73 74207061 636b6167
              65446573 63726970 746f7220 3d207265 71756972 65287061 636b6167 654a736f
              6e506174 68293b5c 6e202020 20202072 65747572 6e207b5c 6e202020 20202020
              20706163 6b616765 44657363 72697074 6f722c5c 6e202020 20202020 20706163
              6b616765 4c6f6361 74696f6e 3a207061 74682e64 69726e61 6d652870 61636b61
              67654a73 6f6e5061 7468292c 5c6e2020 20202020 7d3b5c6e 20202020 7d206361
              74636820 7b5c6e20 20202020 20636f6e 73742070 6172656e 74203d20 70617468
              2e726573 6f6c7665 28637572 72656e74 2c20272e 2e27293b 5c6e2020 20202020
              69662028 70617265 6e74203d 3d3d2063 75727265 6e742920 7b5c6e20 20202020
              20202074 68726f77 20457272 6f722860 436f756c 64206e6f 74206669 6e642070
              61636b61 67652e6a 736f6e20 66726f6d 20247b66 726f6d7d 60293b5c 6e202020
              2020207d 5c6e2020 20207d5c 6e20207d 5c6e7d3b 5c6e5c6e 636f6e73 74206d61
              696e203d 20282920 3d3e207b 5c6e2020 636f6e73 74207b5c 6e202020 2076616c
              7565733a 207b2063 6f6e6669 673a2063 6f6e6669 6746696c 65207d2c 5c6e2020
              2020706f 73697469 6f6e616c 732c5c6e 20207d20 3d207574 696c2e70 61727365
              41726773 287b5c6e 20202020 6f707469 6f6e733a 207b5c6e 20202020 2020636f
              6e666967 3a207b5c 6e202020 20202020 20747970 653a2027 73747269 6e67272c
              5c6e2020 20202020 20206465 6661756c 743a2070 6174682e 6a6f696e 285c6e20
              20202020 20202020 205f5f64 69726e61 6d652c5c 6e202020 20202020 20202027
              2e2e272c 5c6e2020 20202020 20202020 27776562 7061636b 6973682d 61707027
              2c5c6e20 20202020 20202020 20277061 6e747370 61636b2e 636f6e66 69672e6a
              73272c5c 6e202020 20202020 20292c5c 6e202020 2020207d 2c5c6e20 2020207d
              2c5c6e20 20202061 6c6c6f77 506f7369 74696f6e 616c733a 20747275 652c5c6e
              20207d29 3b5c6e5c 6e20202f 2f207265 61642063 6f6e6669 67206669 6c655c6e
              5c6e2020 636f6e73 7420636f 6e666967 53706563 69666965 72203d20 70617468
              2e726573 6f6c7665 28636f6e 66696746 696c6529 3b5c6e5c 6e20206c 65742063
              6f6e6669 67526573 6f6c7665 643b5c6e 20207472 79207b5c 6e202020 20636f6e
              66696752 65736f6c 76656420 3d207265 71756972 652e7265 736f6c76 6528636f
              6e666967 53706563 69666965 72293b5c 6e20207d 20636174 63682028 65727229
              207b5c6e 20202020 636f6e73 6f6c652e 6572726f 72286043 6f756c64 206e6f74
              20726573 6f6c7665 20636f6e 66696720 66696c65 3a20247b 636f6e66 69675370
              65636966 6965727d 60293b5c 6e202020 20746872 6f772065 72723b5c 6e20207d
              5c6e5c6e 20202f2a 2a204074 79706520 7b7b656e 7472793a 20737472 696e672c
              20666f6c 64657273 3a207374 72696e67 5b5d7d7d 202a2f5c 6e20206c 65742063
              6f6e6669 673b5c6e 20207472 79207b5c 6e202020 20636f6e 66696720 3d207265
              71756972 6528636f 6e666967 5265736f 6c766564 293b5c6e 20207d20 63617463
              68202865 72722920 7b5c6e20 20202063 6f6e736f 6c652e65 72726f72 28604572
              726f7220 6c6f6164 696e6720 636f6e66 69672066 696c653a 20247b63 6f6e6669
              67526573 6f6c7665 647d6029 3b5c6e20 20202074 68726f77 20657272 3b5c6e20
              207d5c6e 5c6e2020 636f6e73 74207b20 666f6c64 65727320 7d203d20 636f6e66
              69673b5c 6e5c6e20 20696620 2821666f 6c646572 732e6c65 6e677468 29207b5c
              6e202020 20746872 6f77206e 65772045 72726f72 28604e6f 20666f6c 64657273
              20737065 63696669 65642069 6e20636f 6e666967 2066696c 653a2024 7b636f6e
              66696752 65736f6c 7665647d 2e20506c 65617365 20737065 63696679 20617420
              6c656173 74206f6e 6520666f 6c646572 2e60293b 5c6e2020 7d5c6e5c 6e20202f
              2f206669 6e642070 61636b61 67652064 65736372 6970746f 7220666f 7220636f
              6e666967 5c6e2020 636f6e73 74207b20 7061636b 61676544 65736372 6970746f
              72207d20 3d206669 6e645061 636b6167 65446573 63726970 746f7228 5c6e2020
              20207061 74682e64 69726e61 6d652863 6f6e6669 67526573 6f6c7665 64292c5c
              6e202029 3b5c6e5c 6e202063 6f6e7374 20636f6e 66696744 6972203d 20706174
              682e6469 726e616d 6528636f 6e666967 5265736f 6c766564 293b5c6e 2020636f
              6e737420 736f7572 63657320 3d205b5c 6e202020 20706174 682e7265 736f6c76
              6528636f 6e666967 4469722c 20636f6e 6669672e 656e7472 79292c5c 6e202020
              202e2e2e 706f7369 74696f6e 616c732e 6d617028 736f7572 6365203d 3e207061
              74682e72 65736f6c 76652863 6f6e6669 67446972 2c20736f 75726365 29292c5c
              6e20205d 3b5c6e5c 6e202063 6f6e7374 2070616e 74734865 6170203d 205b5c6e
              20202020 7b5c6e20 20202020 20706163 6b616765 44657363 72697074 6f722c5c
              6e202020 20202073 6f757263 65732c5c 6e202020 207d2c5c 6e20205d 3b5c6e5c
              6e202063 6f6e7374 20666f6c 64656450 616e7473 48656170 203d2066 6f6c6450
              616e7473 466f6c64 65727328 5c6e2020 20207061 6e747348 6561702c 5c6e2020
              20202f2a 2a204074 79706520 7b5b7374 72696e67 2c202e2e 2e737472 696e675b
              5d5d7d20 2a2f2028 666f6c64 65727329 2c5c6e20 20293b5c 6e5c6e20 20666f72
              2028636f 6e737420 7b20666f 6c646564 536f7572 63657320 7d206f66 20666f6c
              64656450 616e7473 48656170 29207b5c 6e202020 20666f72 2028636f 6e737420
              666f6c64 6564536f 75726365 206f6620 666f6c64 6564536f 75726365 7329207b
              5c6e2020 20202020 636f6e73 6f6c652e 6c6f6728 666f6c64 6564536f 75726365
              293b5c6e 20202020 7d5c6e20 207d5c6e 5c6e2020 64656275 67676572 5c6e2020
              72657475 726e2066 6f6c6465 6450616e 74734865 61703b5c 6e7d3b5c 6e5c6e6d
              6f64756c 652e6578 706f7274 73203d20 6d61696e 28293b5c 6e202f2f 2a2f5c6e
              7d295c6e 227d
            ],
            location: 'pantspack.js',
            parser: 'pre-cjs-json',
            record: {
              cjsFunctor: `(function (require, exports, module, __filename, __dirname) { 'use strict'; 'use strict';␊
              ␊
              const { foldPantsFolders } = require('pantspack-folder-runner');␊
              const console = require('node:console');␊
              const path = require('node:path');␊
              const util = require('node:util');␊
              ␊
              /**␊
               * @import {PackageDescriptor} from '../../../../src/types.js'␊
               */␊
              ␊
              /**␊
               *␊
               * @param {string} from␊
               * @returns {{packageDescriptor: PackageDescriptor, packageLocation: string}}␊
               */␊
              const findPackageDescriptor = from => {␊
                const current = from;␊
                for (;;) {␊
                  const packageJsonPath = path.join(current, 'package.json');␊
                  try {␊
                    const packageDescriptor = require(packageJsonPath);␊
                    return {␊
                      packageDescriptor,␊
                      packageLocation: path.dirname(packageJsonPath),␊
                    };␊
                  } catch {␊
                    const parent = path.resolve(current, '..');␊
                    if (parent === current) {␊
                      throw Error(\`Could not find package.json from ${from}\`);␊
                    }␊
                  }␊
                }␊
              };␊
              ␊
              const main = () => {␊
                const {␊
                  values: { config: configFile },␊
                  positionals,␊
                } = util.parseArgs({␊
                  options: {␊
                    config: {␊
                      type: 'string',␊
                      default: path.join(␊
                        __dirname,␊
                        '..',␊
                        'webpackish-app',␊
                        'pantspack.config.js',␊
                      ),␊
                    },␊
                  },␊
                  allowPositionals: true,␊
                });␊
              ␊
                // read config file␊
              ␊
                const configSpecifier = path.resolve(configFile);␊
              ␊
                let configResolved;␊
                try {␊
                  configResolved = require.resolve(configSpecifier);␊
                } catch (err) {␊
                  console.error(\`Could not resolve config file: ${configSpecifier}\`);␊
                  throw err;␊
                }␊
              ␊
                /** @type {{entry: string, folders: string[]}} */␊
                let config;␊
                try {␊
                  config = require(configResolved);␊
                } catch (err) {␊
                  console.error(\`Error loading config file: ${configResolved}\`);␊
                  throw err;␊
                }␊
              ␊
                const { folders } = config;␊
              ␊
                if (!folders.length) {␊
                  throw new Error(\`No folders specified in config file: ${configResolved}. Please specify at least one folder.\`);␊
                }␊
              ␊
                // find package descriptor for config␊
                const { packageDescriptor } = findPackageDescriptor(␊
                  path.dirname(configResolved),␊
                );␊
              ␊
                const configDir = path.dirname(configResolved);␊
                const sources = [␊
                  path.resolve(configDir, config.entry),␊
                  ...positionals.map(source => path.resolve(configDir, source)),␊
                ];␊
              ␊
                const pantsHeap = [␊
                  {␊
                    packageDescriptor,␊
                    sources,␊
                  },␊
                ];␊
              ␊
                const foldedPantsHeap = foldPantsFolders(␊
                  pantsHeap,␊
                  /** @type {[string, ...string[]]} */ (folders),␊
                );␊
              ␊
                for (const { foldedSources } of foldedPantsHeap) {␊
                  for (const foldedSource of foldedSources) {␊
                    console.log(foldedSource);␊
                  }␊
                }␊
              ␊
                debugger␊
                return foldedPantsHeap;␊
              };␊
              ␊
              module.exports = main();␊
               //*/␊
              })␊
              `,
              execute: Function noopExecute {},
              exports: [
                'default',
              ],
              imports: [
                'pantspack-folder-runner',
                'node:console',
                'node:path',
                'node:util',
              ],
              reexports: [],
            },
            sha512: undefined,
            sourceDirname: 'pantspack',
            sourceLocation: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/pantspack/pantspack.js',
          },
        },
        'pantspack>pantspack-folder-runner': {
          './index.js': {
            bytes: Uint8Array [
              7b22696d 706f7274 73223a5b 5d2c2265 78706f72 7473223a 5b22666f 6c645061
              6e747346 6f6c6465 7273222c 22646566 61756c74 225d2c22 72656578 706f7274
              73223a5b 5d2c2273 6f757263 65223a22 2866756e 6374696f 6e202872 65717569
              72652c20 6578706f 7274732c 206d6f64 756c652c 205f5f66 696c656e 616d652c
              205f5f64 69726e61 6d652920 7b202775 73652073 74726963 74273b20 2f2a2a5c
              6e202a20 40696d70 6f727420 7b506163 6b616765 44657363 72697074 6f727d20
              66726f6d 20272e2e 2f2e2e2f 2e2e2f2e 2e2f7372 632f7479 7065732e 6a73275c
              6e202a2f 5c6e5c6e 2f2a2a5c 6e202a20 40747970 65646566 207b2866 696c6570
              6174683a 20737472 696e672c 20706163 6b616765 44657363 72697074 6f723a20
              5061636b 61676544 65736372 6970746f 7229203d 3e20756e 6b6e6f77 6e7d2046
              6f6c6446 6e5c6e20 2a204074 79706564 6566207b 41727261 793c7b70 61636b61
              67654465 73637269 70746f72 3a205061 636b6167 65446573 63726970 746f722c
              20736f75 72636573 3a207374 72696e67 5b5d7d3e 7d205061 6e747348 6561705c
              6e202a20 40747970 65646566 207b4172 7261793c 7b706163 6b616765 44657363
              72697074 6f723a20 5061636b 61676544 65736372 6970746f 722c2066 6f6c6465
              64536f75 72636573 3a20756e 6b6e6f77 6e5b5d7d 3e7d2046 6f6c6465 6450616e
              74734865 61705c6e 202a2f5c 6e5c6e2f 2a2a5c6e 202a2040 6f766572 6c6f6164
              5c6e202a 20407061 72616d20 7b50616e 74734865 61707d20 70616e74 73486561
              7020496e 666f726d 6174696f 6e206162 6f757420 736f7572 63657320 746f2070
              726f7669 64652074 6f206c6f 61646572 735c6e20 2a204070 6172616d 207b5b73
              7472696e 672c202e 2e2e7374 72696e67 5b5d5d7d 2070616e 7473466f 6c646572
              73207061 6e747346 6f6c6465 72206e61 6d65735c 6e202a20 40726574 75726e73
              207b466f 6c646564 50616e74 73486561 707d5c6e 202a2f5c 6e5c6e2f 2a2a5c6e
              202a2040 6f766572 6c6f6164 5c6e202a 20407061 72616d20 7b50616e 74734865
              61707d20 70616e74 73486561 7020496e 666f726d 6174696f 6e206162 6f757420
              736f7572 63657320 746f2070 726f7669 64652074 6f206c6f 61646572 735c6e20
              2a204070 6172616d 207b7374 72696e67 5b5d7d20 5b70616e 7473466f 6c646572
              735d2070 616e7473 466f6c64 6572206e 616d6573 5c6e202a 20407265 7475726e
              73207b50 616e7473 48656170 7c466f6c 64656450 616e7473 48656170 7d5c6e20
              2a2f5c6e 5c6e2f2a 2a5c6e20 2a204070 6172616d 207b5061 6e747348 6561707d
              2070616e 74734865 61702049 6e666f72 6d617469 6f6e2061 626f7574 20736f75
              72636573 20746f20 70726f76 69646520 746f206c 6f616465 72735c6e 202a2040
              70617261 6d207b73 7472696e 675b5d7d 205b7061 6e747346 6f6c6465 72735d20
              70616e74 73466f6c 64657220 6e616d65 735c6e20 2a204072 65747572 6e73207b
              50616e74 73486561 707c466f 6c646564 50616e74 73486561 707d5c6e 202a2f5c
              6e636f6e 73742066 6f6c6450 616e7473 466f6c64 65727320 3d202870 616e7473
              48656170 2c207061 6e747346 6f6c6465 7273203d 205b5d29 203d3e5c 6e202070
              616e7473 466f6c64 6572732e 6c656e67 74685c6e 20202020 3f207061 6e747346
              6f6c6465 72732e66 6c61744d 61702870 616e7473 466f6c64 6572203d 3e207b5c
              6e202020 20202020 202f2a2a 20407479 7065207b 73747269 6e677d20 2a2f5c6e
              20202020 20202020 6c657420 70616e74 73466f6c 64657250 6174683b 5c6e2020
              20202020 20207472 79207b5c 6e202020 20202020 20202070 616e7473 466f6c64
              65725061 7468203d 20726571 75697265 2e726573 6f6c7665 2870616e 7473466f
              6c646572 293b5c6e 20202020 20202020 7d206361 74636820 28657272 29207b5c
              6e202020 20202020 20202074 68726f77 20457272 6f722860 436f756c 64206e6f
              74207265 736f6c76 65207061 6e747346 6f6c6465 72205c22 247b7061 6e747346
              6f6c6465 727d5c22 602c207b 5c6e2020 20202020 20202020 20206361 7573653a
              20657272 2c5c6e20 20202020 20202020 207d293b 5c6e2020 20202020 20207d5c
              6e5c6e20 20202020 2020202f 2a2a2040 74797065 207b466f 6c64466e 7d202a2f
              5c6e2020 20202020 20206c65 7420666f 6c643b5c 6e202020 20202020 202f2a2a
              20407479 7065207b 73747269 6e675b5d 7d202a2f 5c6e2020 20202020 20206c65
              74206578 74656e73 696f6e73 3b5c6e5c 6e202020 20202020 20747279 207b5c6e
              20202020 20202020 20202f2a 2a204074 79706520 7b7b666f 6c643a20 466f6c64
              466e2c20 65787465 6e73696f 6e733a20 73747269 6e675b5d 7d7d202a 2f5c6e20
              20202020 20202020 20287b20 666f6c64 2c206578 74656e73 696f6e73 207d203d
              20726571 75697265 2870616e 7473466f 6c646572 50617468 29293b5c 6e202020
              20202020 207d2063 61746368 20286572 7229207b 5c6e2020 20202020 20202020
              7468726f 77204572 726f7228 5c6e2020 20202020 20202020 20206043 6f756c64
              206e6f74 20726571 75697265 2070616e 7473466f 6c646572 205c2224 7b70616e
              7473466f 6c646572 7d5c2220 76696120 247b7061 6e747346 6f6c6465 72506174
              687d602c 5c6e2020 20202020 20202020 20207b20 63617573 653a2065 7272207d
              2c5c6e20 20202020 20202020 20293b5c 6e202020 20202020 207d5c6e 5c6e2020
              20202020 20206966 20287479 70656f66 20666f6c 6420213d 3d202766 756e6374
              696f6e27 29207b5c 6e202020 20202020 20202074 68726f77 20457272 6f72285c
              6e202020 20202020 20202020 20604578 70656374 65642070 616e7473 466f6c64
              6572205c 22247b70 616e7473 466f6c64 65727d5c 22207669 6120247b 70616e74
              73466f6c 64657250 6174687d 20746f20 6578706f 72742061 20666f6c 64282920
              66756e63 74696f6e 3b20676f 7420247b 666f6c64 7d602c5c 6e202020 20202020
              20202029 3b5c6e20 20202020 2020207d 5c6e5c6e 20202020 20202020 69662028
              21417272 61792e69 73417272 61792865 7874656e 73696f6e 7329207c 7c206578
              74656e73 696f6e73 2e6c656e 67746820 3d3d3d20 3029207b 5c6e2020 20202020
              20202020 7468726f 77204572 726f7228 5c6e2020 20202020 20202020 20206045
              78706563 74656420 70616e74 73466f6c 64657220 5c22247b 70616e74 73466f6c
              6465727d 5c222076 69612024 7b70616e 7473466f 6c646572 50617468 7d20746f
              20657870 6f727420 61206e6f 6e2d656d 70747920 61727261 79206f66 2066696c
              65206578 74656e73 696f6e73 3b20676f 7420247b 65787465 6e73696f 6e737d60
              2c5c6e20 20202020 20202020 20293b5c 6e202020 20202020 207d5c6e 5c6e2020
              20202020 20202f2f 2066696e 6420616c 6c20736f 75726365 73206d61 74636869
              6e672074 68652065 7874656e 73696f6e 732c2074 68656e20 63616c6c 20666f6c
              64282920 6f6e2065 6163685c 6e202020 20202020 20636f6e 73742066 6f6c6465
              6450616e 74734865 6170203d 2070616e 74734865 61702e6d 6170285c 6e202020
              20202020 20202028 7b207061 636b6167 65446573 63726970 746f722c 20736f75
              72636573 207d2920 3d3e207b 5c6e2020 20202020 20202020 2020636f 6e737420
              736f7572 63657346 6f724c6f 61646572 203d2073 6f757263 65732e66 696c7465
              7228736f 75726365 203d3e5c 6e202020 20202020 20202020 20202065 7874656e
              73696f6e 732e736f 6d652865 7874203d 3e20736f 75726365 2e656e64 73576974
              68286578 7429292c 5c6e2020 20202020 20202020 2020293b 5c6e2020 20202020
              20202020 2020636f 6e737420 666f6c64 6564536f 75726365 73203d20 736f7572
              63657346 6f724c6f 61646572 2e6d6170 28736f75 72636520 3d3e207b 5c6e2020
              20202020 20202020 20202020 74727920 7b5c6e20 20202020 20202020 20202020
              20202072 65747572 6e20666f 6c642873 6f757263 652c2070 61636b61 67654465
              73637269 70746f72 293b5c6e 20202020 20202020 20202020 20207d20 63617463
              68202865 72722920 7b5c6e20 20202020 20202020 20202020 20202074 68726f77
              20457272 6f72285c 6e202020 20202020 20202020 20202020 20202060 4572726f
              7220666f 6c64696e 6720736f 75726365 205c2224 7b736f75 7263657d 5c222066
              6f722070 61636b61 6765205c 22247b70 61636b61 67654465 73637269 70746f72
              2e6e616d 657d5c22 3a20247b 6572722e 6d657373 6167657d 602c5c6e 20202020
              20202020 20202020 20202020 20207b20 63617573 653a2065 7272207d 2c5c6e20
              20202020 20202020 20202020 20202029 3b5c6e20 20202020 20202020 20202020
              207d5c6e 20202020 20202020 20202020 7d293b5c 6e202020 20202020 20202020
              20726574 75726e20 7b207061 636b6167 65446573 63726970 746f722c 20666f6c
              64656453 6f757263 6573207d 3b5c6e20 20202020 20202020 207d2c5c 6e202020
              20202020 20293b5c 6e5c6e20 20202020 20202072 65747572 6e20666f 6c646564
              50616e74 73486561 703b5c6e 20202020 20207d29 5c6e2020 20203a20 70616e74
              73486561 703b5c6e 5c6e6578 706f7274 732e666f 6c645061 6e747346 6f6c6465
              7273203d 20666f6c 6450616e 7473466f 6c646572 733b5c6e 202f2f2a 2f5c6e7d
              295c6e22 7d
            ],
            location: 'index.js',
            parser: 'pre-cjs-json',
            record: {
              cjsFunctor: `(function (require, exports, module, __filename, __dirname) { 'use strict'; /**␊
               * @import {PackageDescriptor} from '../../../../src/types.js'␊
               */␊
              ␊
              /**␊
               * @typedef {(filepath: string, packageDescriptor: PackageDescriptor) => unknown} FoldFn␊
               * @typedef {Array<{packageDescriptor: PackageDescriptor, sources: string[]}>} PantsHeap␊
               * @typedef {Array<{packageDescriptor: PackageDescriptor, foldedSources: unknown[]}>} FoldedPantsHeap␊
               */␊
              ␊
              /**␊
               * @overload␊
               * @param {PantsHeap} pantsHeap Information about sources to provide to loaders␊
               * @param {[string, ...string[]]} pantsFolders pantsFolder names␊
               * @returns {FoldedPantsHeap}␊
               */␊
              ␊
              /**␊
               * @overload␊
               * @param {PantsHeap} pantsHeap Information about sources to provide to loaders␊
               * @param {string[]} [pantsFolders] pantsFolder names␊
               * @returns {PantsHeap|FoldedPantsHeap}␊
               */␊
              ␊
              /**␊
               * @param {PantsHeap} pantsHeap Information about sources to provide to loaders␊
               * @param {string[]} [pantsFolders] pantsFolder names␊
               * @returns {PantsHeap|FoldedPantsHeap}␊
               */␊
              const foldPantsFolders = (pantsHeap, pantsFolders = []) =>␊
                pantsFolders.length␊
                  ? pantsFolders.flatMap(pantsFolder => {␊
                      /** @type {string} */␊
                      let pantsFolderPath;␊
                      try {␊
                        pantsFolderPath = require.resolve(pantsFolder);␊
                      } catch (err) {␊
                        throw Error(\`Could not resolve pantsFolder "${pantsFolder}"\`, {␊
                          cause: err,␊
                        });␊
                      }␊
              ␊
                      /** @type {FoldFn} */␊
                      let fold;␊
                      /** @type {string[]} */␊
                      let extensions;␊
              ␊
                      try {␊
                        /** @type {{fold: FoldFn, extensions: string[]}} */␊
                        ({ fold, extensions } = require(pantsFolderPath));␊
                      } catch (err) {␊
                        throw Error(␊
                          \`Could not require pantsFolder "${pantsFolder}" via ${pantsFolderPath}\`,␊
                          { cause: err },␊
                        );␊
                      }␊
              ␊
                      if (typeof fold !== 'function') {␊
                        throw Error(␊
                          \`Expected pantsFolder "${pantsFolder}" via ${pantsFolderPath} to export a fold() function; got ${fold}\`,␊
                        );␊
                      }␊
              ␊
                      if (!Array.isArray(extensions) || extensions.length === 0) {␊
                        throw Error(␊
                          \`Expected pantsFolder "${pantsFolder}" via ${pantsFolderPath} to export a non-empty array of file extensions; got ${extensions}\`,␊
                        );␊
                      }␊
              ␊
                      // find all sources matching the extensions, then call fold() on each␊
                      const foldedPantsHeap = pantsHeap.map(␊
                        ({ packageDescriptor, sources }) => {␊
                          const sourcesForLoader = sources.filter(source =>␊
                            extensions.some(ext => source.endsWith(ext)),␊
                          );␊
                          const foldedSources = sourcesForLoader.map(source => {␊
                            try {␊
                              return fold(source, packageDescriptor);␊
                            } catch (err) {␊
                              throw Error(␊
                                \`Error folding source "${source}" for package "${packageDescriptor.name}": ${err.message}\`,␊
                                { cause: err },␊
                              );␊
                            }␊
                          });␊
                          return { packageDescriptor, foldedSources };␊
                        },␊
                      );␊
              ␊
                      return foldedPantsHeap;␊
                    })␊
                  : pantsHeap;␊
              ␊
              exports.foldPantsFolders = foldPantsFolders;␊
               //*/␊
              })␊
              `,
              execute: Function noopExecute {},
              exports: [
                'foldPantsFolders',
                'default',
              ],
              imports: [],
              reexports: [],
            },
            sha512: undefined,
            sourceDirname: 'pantspack-folder-runner',
            sourceLocation: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/pantspack-folder-runner/index.js',
          },
        },
        undefined: {},
      },
      compartmentRenames: {
        $root$: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/',
        '<ATTENUATORS>': '<ATTENUATORS>',
        'jorts-folder': 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/jorts-folder/',
        pantspack: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/pantspack/',
        'pantspack>pantspack-folder-runner': 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/pantspack-folder-runner/',
      },
      newToOldCompartmentNames: {
        $root$: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/',
        '<ATTENUATORS>': '<ATTENUATORS>',
        'jorts-folder': 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/jorts-folder/',
        pantspack: 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/pantspack/',
        'pantspack>pantspack-folder-runner': 'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/pantspack-folder-runner/',
      },
      oldToNewCompartmentNames: {
        '<ATTENUATORS>': '<ATTENUATORS>',
        'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/jorts-folder/': 'jorts-folder',
        'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/pantspack-folder-runner/': 'pantspack>pantspack-folder-runner',
        'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/pantspack/': 'pantspack',
        'file:///Users/boneskull/projects/endojs/endo/packages/compartment-mapper/test/fixtures-dynamic-ancestor/node_modules/webpackish-app/': '$root$',
      },
    }
